services:
  # ------------------------------------------
  # 1. Agent Wiring (Standalone)
  # ------------------------------------------
  agent:
    # Participate in Network Directly
    networks:
      - external_network
    depends_on:
      registry: { condition: service_healthy }
    environment:
      - AGENT_RUNTIME=docker
      - CONTAINER_REGISTRY=esb-registry:5010
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  # ------------------------------------------
  # 2. Gateway Wiring
  # ------------------------------------------
  gateway:
    depends_on:
      agent: { condition: service_started }
    environment:
      # Connect to Agent Directly
      - AGENT_GRPC_ADDRESS=agent:50051
