# Toolchain versions managed by mise.
 
[tools]
# Runtimes
python = "3.12"
go = "1.25.1"
uv = "0.8.13"
lefthook = "latest"
mkcert = "1.4.4"
 
# Go tooling (installed via go install)
"go:github.com/golangci/golangci-lint/cmd/golangci-lint" = "latest"
"go:mvdan.cc/gofumpt" = "latest"
"go:golang.org/x/tools/cmd/goimports" = "latest"
"go:github.com/air-verse/air" = "latest"

[env]
_.path = ["~/.local/bin"]
CAROOT = "{{env.HOME}}/.esb/certs"
 
[tasks.setup]
description = "Install dependencies and enable git hooks"
run = [
  "uv sync --all-extras",
  "lefthook install",
  "go build -C cli -o ~/.local/bin/esb ./cmd/esb",
  "esb config set-repo .",
  "mise run setup:certs",
]

[tasks."setup:certs"]
description = "Generate development certificates using mkcert"
run = "uv run python tools/cert-gen/generate.py"
 
[tasks.build-cli]
description = "Build esb CLI to ~/.local/bin"
dir = "cli"
run = "go build -o ~/.local/bin/esb ./cmd/esb"
 
[tasks.dev-cli]
description = "Watch and rebuild esb CLI on changes"
dir = "cli"
run = "air"
