# [A] Compose file for running on the host OS (starts the DinD parent container).
# Use this file to start the entire DinD environment in production.

services:
  # ============================================
  # Root DinD Container
  # ============================================
  esb-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: esb-root
    privileged: true  # Required for DinD.
    ports:
      - "443:443"     # Gateway API (HTTPS)
      - "9000:9000"   # RustFS API
      - "9001:9001"   # RustFS Console
      - "9428:9428"   # VictoriaLogs
      - "8001:8001"   # ScyllaDB Alternator
    volumes:
      # Data persistence (host OS -> parent container -> child container).
      - ./data:/app/data
      # Log aggregation.
      - ./logs:/logs
    restart: unless-stopped
