[
  {
    "name": "http_https_auth_no_proxy",
    "env": {
      "HTTP_PROXY": "http://user:pass@proxy-http.example:8080",
      "HTTPS_PROXY": "http://proxy-https.example:8443",
      "NO_PROXY": "localhost,127.0.0.1,.example.com;registry:5010;[::1]:5010"
    },
    "expected_xml": "<settings>\n  <proxies>\n    <proxy>\n      <id>http-proxy</id>\n      <active>true</active>\n      <protocol>http</protocol>\n      <host>proxy-http.example</host>\n      <port>8080</port>\n      <username>user</username>\n      <password>pass</password>\n      <nonProxyHosts>localhost|127.0.0.1|*.example.com|registry|::1</nonProxyHosts>\n    </proxy>\n    <proxy>\n      <id>https-proxy</id>\n      <active>true</active>\n      <protocol>https</protocol>\n      <host>proxy-https.example</host>\n      <port>8443</port>\n      <nonProxyHosts>localhost|127.0.0.1|*.example.com|registry|::1</nonProxyHosts>\n    </proxy>\n  </proxies>\n</settings>\n"
  },
  {
    "name": "http_only_https_fallback",
    "env": {
      "http_proxy": "http://proxy-only.example:3128",
      "NO_PROXY": "api.local;.corp.internal,cache:8080"
    },
    "expected_xml": "<settings>\n  <proxies>\n    <proxy>\n      <id>http-proxy</id>\n      <active>true</active>\n      <protocol>http</protocol>\n      <host>proxy-only.example</host>\n      <port>3128</port>\n      <nonProxyHosts>api.local|*.corp.internal|cache</nonProxyHosts>\n    </proxy>\n    <proxy>\n      <id>https-proxy</id>\n      <active>true</active>\n      <protocol>https</protocol>\n      <host>proxy-only.example</host>\n      <port>3128</port>\n      <nonProxyHosts>api.local|*.corp.internal|cache</nonProxyHosts>\n    </proxy>\n  </proxies>\n</settings>\n"
  },
  {
    "name": "proxy_unset",
    "env": {},
    "expected_xml": "<settings>\n  <proxies>\n  </proxies>\n</settings>\n"
  },
  {
    "name": "invalid_scheme",
    "env": {
      "HTTP_PROXY": "socks5://proxy.example:1080"
    },
    "expected_error_substring": "must use http or https scheme"
  },
  {
    "name": "invalid_port",
    "env": {
      "HTTP_PROXY": "http://proxy.example:70000"
    },
    "expected_error_substring": "has invalid port"
  },
  {
    "name": "path_forbidden",
    "env": {
      "HTTPS_PROXY": "http://proxy.example:8080/path"
    },
    "expected_error_substring": "must not include path/query/fragment"
  }
]
