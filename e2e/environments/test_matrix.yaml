# Test Execution Matrix
# Defines which Test Suites run on which ESB environments.

suites:
  smoke:
    description: Fast connectivity tests for all components
    targets:
    - ../scenarios/smoke/test_connectivity.py
    - ../scenarios/smoke/test_smoke.py
    exclude: []
  standard:
    description: Standard E2E Scenarios (Autoscaling + Standard)
    targets:
    - ../scenarios/autoscaling/
    - ../scenarios/standard/
    exclude: []
  runtime:
    description: Runtime Scenarios (non-smoke)
    targets:
    - ../scenarios/runtime/java/
    - ../scenarios/runtime/python/
    exclude: []
  restart:
    description: Restart scenarios
    targets:
    - ../scenarios/restart/
    exclude: []

matrix:
# docker runtime
- esb_env: e2e-docker
  deploy_templates:
  - e2e/fixtures/template.core.yaml
  - e2e/fixtures/template.stateful.yaml
  - e2e/fixtures/template.image.yaml
  env_vars:
    E2E_IMAGE_EXPECTED_LOGGER: cloudwatch.logs.python
  image_uri_overrides:
    lambda-image: 127.0.0.1:5010/esb-e2e-lambda-python:latest
  image_runtime_overrides:
    lambda-image: python
  suites:
  - smoke
  - standard
  - runtime
  - restart

# containerd runtime
- esb_env: e2e-containerd
  deploy_templates:
  - e2e/fixtures/template.core.yaml
  - e2e/fixtures/template.stateful.yaml
  - e2e/fixtures/template.image.yaml
  env_vars:
    E2E_IMAGE_EXPECTED_LOGGER: cloudwatch.logs.java
  image_uri_overrides:
    lambda-image: 127.0.0.1:5010/esb-e2e-lambda-java:latest
  image_runtime_overrides:
    lambda-image: java21
  suites:
  - smoke
  - standard

# containerd + firecracker runtime (CONTAINERD_RUNTIME=aws.firecracker)
# - esb_env: e2e-firecracker
#   suites:
#   - smoke
#   - standard
