syntax = "proto3";

package esb.agent.v1;
option go_package = "github.com/poruru/edge-serverless-box/services/agent/pkg/api/v1";

service AgentService {
  // Ensure a container and return connection info (start if missing, reuse if present).
  rpc EnsureContainer (EnsureContainerRequest) returns (WorkerInfo);
  
  // Explicitly stop and remove a container.
  rpc DestroyContainer (DestroyContainerRequest) returns (DestroyContainerResponse);

  // Pause a container (for warm starts).
  rpc PauseContainer (PauseContainerRequest) returns (PauseContainerResponse);

  // Resume a container (for warm starts).
  rpc ResumeContainer (ResumeContainerRequest) returns (ResumeContainerResponse);

  // Get state of all managed containers (Phase 3: Janitor).
  rpc ListContainers (ListContainersRequest) returns (ListContainersResponse);
}

message PauseContainerRequest {
  string container_id = 1;
}

message PauseContainerResponse {
  bool success = 1;
}

message ResumeContainerRequest {
  string container_id = 1;
}

message ResumeContainerResponse {
  bool success = 1;
}

message EnsureContainerRequest {
  string function_name = 1;
  string image = 2;
  map<string, string> env = 3;
}

message DestroyContainerRequest {
  string function_name = 1;
  string container_id = 2;
}

message DestroyContainerResponse {
  bool success = 1;
}

message WorkerInfo {
  string id = 1;
  string name = 2;
  string ip_address = 3;
  int32 port = 4;
}

// Phase 3: message for ListContainers.
message ListContainersRequest {}

message ListContainersResponse {
  repeated ContainerState containers = 1;
}

message ContainerState {
  string container_id = 1;
  string function_name = 2;
  string status = 3;      // "RUNNING", "PAUSED", "STOPPED", "UNKNOWN"
  int64 last_used_at = 4; // Unix Timestamp (seconds)
  string container_name = 5;
  int64 created_at = 6;   // Unix Timestamp (seconds) - container creation time
}
